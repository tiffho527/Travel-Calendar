<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trip Calendar</title>

<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">

<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; }
  header { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
  button { cursor:pointer; padding:6px 12px; }
  #calendar, #listView { max-width:900px; margin:0 auto; }
  #listView { display:none; padding:10px; }
  .list-event { border:1px solid #ccc; padding:10px; margin-bottom:5px; cursor:pointer; }

  /* Modal */
  #eventModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.55); z-index:6000; overflow:auto; }
  #eventModal .modal-content { background:#fff; margin:5% auto; padding:20px; width:400px; border-radius:8px; position:relative; z-index:6001; }
  #modalClose { position:absolute; top:10px; right:10px; cursor:pointer; font-weight:bold; color:red; }
  #eventModal input, #eventModal textarea { width:100%; margin-bottom:10px; padding:5px; }
  #photoPreview img { max-width:80px; margin:5px; position:relative; }
  .remove-photo { position:absolute; top:0; right:0; background:red; color:white; font-weight:bold; border:none; cursor:pointer; border-radius:50%; }
  #travelNext a { margin-right:5px; display:inline-block; }
</style>
</head>
<body>

<header>
  <button id="monthViewBtn">Month</button>
  <button id="weekViewBtn">Week</button>
  <button id="dayViewBtn">Day</button>
  <button id="toggleViewBtn">Toggle Calendar/List</button>
  <button id="addEventBtn">Add Event</button>
</header>

<div id="calendar"></div>
<div id="listView"></div>

<!-- Event Modal -->
<div id="eventModal">
  <div class="modal-content">
    <span id="modalClose">âœ–</span>
    <h2>Edit Event</h2>
    <input type="text" id="eventTitle" placeholder="Title">
    <input type="datetime-local" id="eventStart" placeholder="Start Time">
    <input type="datetime-local" id="eventEnd" placeholder="End Time">
    <input type="text" id="eventAddress" placeholder="Address">
    <h3>Notes</h3>
    <input type="text" id="noteReservation" placeholder="Reservation">
    <input type="text" id="noteCost" placeholder="Cost">
    <input type="text" id="noteDirections" placeholder="Directions">
    <input type="text" id="noteBring" placeholder="To Bring">
    <input type="text" id="noteLinks" placeholder="Links, comma separated">
    <input type="file" id="notePhotos" multiple>
    <div id="photoPreview"></div>
    <div id="travelNext"></div>
    <button id="saveEvent">Save Event</button>
    <button id="deleteEvent" style="background:red; color:white;">Delete Event</button>
  </div>
</div>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');
  const listEl = document.getElementById('listView');
  let isCalendarView = true;
  let currentEventId = null;

  // Convert date string to datetime-local format (local time)
  function toDateTimeLocalString(dateStr){
    const d = new Date(dateStr);
    if(isNaN(d)) return '';
    const pad = n => String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  // Generate unique ID
  function generateId() { return 'evt-' + Math.random().toString(36).substr(2, 9); }

  // Load events from localStorage or default
  let stored = JSON.parse(localStorage.getItem('events')) || [
    // TOKYO: Jan 26 â€“ Feb 1
    { title: "Arrival in Tokyo", start: "2026-01-26T15:20:00", end: "2026-01-26T17:15:00", address: "Narita Airport, Tokyo", notes: { reservation:"Flight lands at 3:20 PM", cost:"", directions:"Exit terminal, customs ~4:45-5:00 PM", toBring:"Passport, luggage", links:["https://www.narita-airport.jp/en"], photos:[] } },
    { title: "Narita Express to Shinjuku", start: "2026-01-26T17:15:00", end: "2026-01-26T18:50:00", address: "Narita Express train", notes: { reservation:"", cost:"~3000 JPY", directions:"80 min ride to Shinjuku", toBring:"Train ticket", links:[], photos:[] } },
    { title: "Check-in Hilton Tokyo", start: "2026-01-26T18:50:00", address: "Hilton Tokyo, Shinjuku", notes: { reservation:"Check-in", cost:"", directions:"5 min walk from Shinjuku Station", toBring:"", links:["https://www.hilton.com/en/hotels/tyohitw-hilton-tokyo/"], photos:[] } },
    { title: "Evening: Ginza Shopping", start: "2026-01-26T20:00:00", address: "Ginza, Tokyo", notes: { reservation:"", cost:"", directions:"Explore department stores or casual dining", toBring:"", links:[], photos:[] } },
    { title: "Drop off custom embroidery @ Uniqlo Asakusa", start: "2026-01-27T10:00:00", end: "2026-01-27T12:00:00", address: "Uniqlo Asakusa, Tokyo", notes: { reservation:"", cost:"", directions:"", toBring:"Embroidery items", links:["https://www.uniqlo.com/jp/store/asakusa"], photos:[] } },
    { title: "Lunch @ Waunn.Tokyo", start: "2026-01-27T12:00:00", end: "2026-01-27T14:00:00", address: "Waunn.Tokyo", notes: { reservation:"Confirmed", cost:"", directions:"", toBring:"", links:[], photos:[] } },
    { title: "Harry CafÃ© â€“ Various Animals", start: "2026-01-27T14:00:00", end: "2026-01-27T15:30:00", address: "ã€’111-0032 Tokyo, Taito City, Asakusa, 1-chÅme-1-17 å¢—ç”°ãƒ“ãƒ« 5F", notes: { reservation:"Check availability Dec 27", cost:"", directions:"5 min walk from Waunn", toBring:"", links:["https://harinezumi-cafe.com/en/store/asakusa/"], photos:[] } },
    { title: "Kiwa Seisakujo Asakusabashi (craft supplies)", start: "2026-01-27T15:30:00", end: "2026-01-27T19:30:00", address: "ã€’111-0053 Tokyo, Taito City, Asakusabashi, 2-chÅmeâˆ’1âˆ’2", notes: { reservation:"", cost:"", directions:"15 min train from Asakusa", toBring:"", links:[], photos:[] } },
    { title: "Dinner @ Zauo Shinjuku", start: "2026-01-27T19:30:00", address: "3-2-9 Nishishinjuku, Shinjuku City, Tokyo 160-0023", notes: { reservation:"Confirmed", cost:"", directions:"10 min walk from Hilton Tokyo", toBring:"", links:["https://www.zauo.co.jp/en/shop/shinjuku/","https://www.tablecheck.com/en/shops/zauo-shinjuku/reserve"], photos:[] } },
    { title: "Breakfast @ Shinpachi Shokudo", start: "2026-01-28T08:30:00", end: "2026-01-28T09:30:00", address: "Shinjuku, Tokyo", notes: { reservation:"", cost:"", directions:"5-7 min walk from Hilton Tokyo", toBring:"", links:[], photos:[] } },
    { title: "Tokyo Metropolitan Government Building Observatory", start: "2026-01-28T09:30:00", end: "2026-01-28T12:00:00", address: "Shinjuku, Tokyo", notes: { reservation:"Free entry", cost:"", directions:"15 min walk", toBring:"", links:[], photos:[] } },
    { title: "CAPPINESS Capybara CafÃ©", start: "2026-01-28T12:00:00", end: "2026-01-28T17:00:00", address: "Harajuku, Tokyo", notes: { reservation:"Available 14 days in advance", cost:"", directions:"30 min via JR Yamanote Line from Shinjuku", toBring:"", links:["https://www.tablecheck.com/en/shops/cappiness/reserve"], photos:[] } },
    { title: "Hotel Change to ANA InterContinental Tokyo", start: "2026-01-28T17:00:00", end: "2026-01-28T18:00:00", address: "Roppongi, Tokyo", notes: { reservation:"Late checkout Hilton", cost:"", directions:"25 min taxi / 35 min train", toBring:"Bags, personal items", links:["https://www.anaintercontinental-tokyo.com/"], photos:[] } },
    { title: "Kinokurashi Ginza Chopstick Making Class", start: "2026-01-28T18:00:00", address: "Kinokurashi Ginza", notes: { reservation:"Confirmed", cost:"", directions:"15â€“25 min from hotel", toBring:"", links:[], photos:[] } },
    { title: "Depart Hotel â†’ Snoopy Museum", start: "2026-01-29T08:20:00", end: "2026-01-29T10:00:00", address: "ANA InterContinental Tokyo", notes: { reservation:"", cost:"", directions:"Train to Snoopy Museum ~1h 20min", toBring:"", links:["https://snoopymuseum.tokyo/s/smt/?ima=0000"], photos:[] } },
    { title: "Peanuts CafÃ© / Snoopy Museum", start: "2026-01-29T10:00:00", end: "2026-01-29T12:45:00", address: "Snoopy Museum Tokyo", notes: { reservation:"", cost:"", directions:"Museum hours 10:00â€“18:00, last entry 17:30", toBring:"", links:[], photos:[] } },
    { title: "Shin-Yokohama Ramen Museum", start: "2026-01-29T12:45:00", address: "Shin-Yokohama", notes: { reservation:"Meet with MC", cost:"450 yen admission", directions:"~40 min travel from museum", toBring:"", links:["https://www.raumen.co.jp/","https://www.raumen.co.jp/makingnoodle_en.html","https://www.asoview.com/channel/activities/ja/takigami-raumen/offices/2268/courses?language_type=en"], photos:[] } },
    { title: "Dinner @ Ginza Happo", start: "2026-01-30T19:00:00", address: "Ginza, Tokyo", notes: { reservation:"Confirmed", cost:"", directions:"", toBring:"", links:["https://ginzahappo.owst.jp"], photos:[] } },
    { title: "Lunch @ Gyukatsu Motomura Shinjuku Minamiguchi", start: "2026-01-31T11:00:00", end: "2026-01-31T13:00:00", address: "3-32-6 Shinjuku, Tokyo", notes: { reservation:"Book after Dec 29", cost:"", directions:"", toBring:"", links:["https://www.tablecheck.com/en/shops/gyukatsu-motomura-shinjuku-minamiguchi/reserve"], photos:[] } },
    { title: "Kuu Head Spa", start: "2026-01-31T13:00:00", end: "2026-01-31T16:00:00", address: "OmotesandÅ, Tokyo", notes: { reservation:"TBD", cost:"", directions:"JR Yamanote to Shibuya + Ginza Line to Omotesando", toBring:"", links:[], photos:[] } },
    { title: "Raymond Lam Concert", start: "2026-02-01T15:00:00", address: "Tokyo Garden Theater, Ariake", notes: { reservation:"Confirmed tickets received", cost:"", directions:"Arrive 1h early for photos, merch, snacks", toBring:"", links:[], photos:[] } },

    // SAPPORO: Feb 2 â€“ Feb 10
    { title: "Fly Tokyo â†’ Sapporo", start: "2026-02-02T12:50:00", end: "2026-02-02T15:30:00", address: "HND â†’ CTS", notes: { reservation:"Flight", cost:"", directions:"Depart ANA InterContinental Tokyo 10:40 AM", toBring:"Passport, luggage", links:[], photos:[] } },
    { title: "Arrive Sapporo / Check-in Fairfield Marriott", start: "2026-02-02T15:30:00", address: "Fairfield Marriott Sapporo", notes: { reservation:"", cost:"", directions:"Rapid Airport Express to Sapporo Station, walk/taxi 5â€“10 min", toBring:"", links:["https://www.marriott.com/en-us/hotels/cepfs-fairfield-marriott-sapporo/overview/"], photos:[] } },
    { title: "Explore Sapporo", start: "2026-02-03T09:00:00", address: "Sapporo", notes: { reservation:"", cost:"", directions:"", toBring:"", links:[], photos:[] } },
    { title: "Explore Sapporo / Meet with MC", start: "2026-02-04T14:00:00", address: "Sapporo", notes: { reservation:"", cost:"", directions:"", toBring:"", links:[], photos:[] } },
    { title: "Royce' Chocolate World", start: "2026-02-05T10:00:00", address: "2-2-2 Kita 7 Jonishi, Chitose, Hokkaido 066-0061", notes: { reservation:"DIY chocolate tickets", cost:"", directions:"Train 1h10 from Sapporo, taxi/walk from station", toBring:"", links:["https://www.e-tix.jp/royce-cct/en/"], photos:[] } },
    { title: "Explore Sapporo / Bentley returns", start: "2026-02-06T09:00:00", address: "Sapporo", notes: { reservation:"", cost:"", directions:"MC flight 2pm", toBring:"", links:[], photos:[] } },
    { title: "Explore Sapporo", start: "2026-02-07T09:00:00", address: "Sapporo", notes: { reservation:"", cost:"", directions:"", toBring:"", links:[], photos:[] } },
    { title: "Explore Sapporo", start: "2026-02-08T09:00:00", address: "Sapporo", notes: { reservation:"", cost:"", directions:"", toBring:"", links:[], photos:[] } },
    { title: "Fly Sapporo â†’ Tokyo", start: "2026-02-09T10:00:00", address: "CTS â†’ HND", notes: { reservation:"Flight", cost:"", directions:"Leave Sapporo hotel early", toBring:"Passport, luggage", links:[], photos:[] } },
    { title: "Fly Home", start: "2026-02-10T10:00:00", address: "HND", notes: { reservation:"Flight", cost:"", directions:"", toBring:"Passport, luggage", links:[], photos:[] } }
  ];


  // Assign IDs and default end times
  stored.forEach(e => {
    if(!e.id) e.id = generateId();
    if(!e.end) e.end = toDateTimeLocalString(new Date(new Date(e.start).getTime() + 60*60*1000)); // +1 hour
  });

  function saveToStorage(){
    localStorage.setItem('events', JSON.stringify(stored));
  }

  // Initialize Calendar
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    events: stored,
    eventClick: info => openEventModal(info.event)
  });
  calendar.render();

  // Render list view
  function renderList() {
    listEl.innerHTML = '';
    stored.sort((a,b)=>new Date(a.start)-new Date(b.start)).forEach(evt=>{
      const div = document.createElement('div');
      div.className='list-event';
      div.textContent = `${new Date(evt.start).toLocaleString()} - ${evt.title}`;
      div.onclick = ()=> openEventModalFromId(evt.id);
      listEl.appendChild(div);
    });
  }

  // Open modal from ID
  function openEventModalFromId(id){
    const evt = stored.find(e=>e.id===id);
    if(!evt) return;
    currentEventId = id;
    document.getElementById('eventTitle').value=evt.title;
    document.getElementById('eventStart').value=toDateTimeLocalString(evt.start);
    document.getElementById('eventEnd').value = evt.end ? toDateTimeLocalString(evt.end) 
      : toDateTimeLocalString(new Date(new Date(evt.start).getTime() + 60*60*1000));
    document.getElementById('eventAddress').value=evt.address||'';
    const notes=evt.notes||{};
    document.getElementById('noteReservation').value=notes.reservation||'';
    document.getElementById('noteCost').value=notes.cost||'';
    document.getElementById('noteDirections').value=notes.directions||'';
    document.getElementById('noteBring').value=notes.toBring||'';
    document.getElementById('noteLinks').value=notes.links?notes.links.join(','):'';
    const photoPreview = document.getElementById('photoPreview');
    photoPreview.innerHTML='';
    if(notes.photos){
      notes.photos.forEach(p=>{
        const img = document.createElement('img'); img.src=p;
        const removeBtn = document.createElement('button');
        removeBtn.textContent='Ã—';
        removeBtn.className='remove-photo';
        removeBtn.onclick=()=>{ img.remove(); removeBtn.remove(); };
        photoPreview.appendChild(img);
        photoPreview.appendChild(removeBtn);
      });
    }
    // Next event links
    let nextHTML='';
    const idx = stored.findIndex(e=>e.id===id);
    if(idx<stored.length-1){
      const nextEvt = stored[idx+1];
      const origin=encodeURIComponent(evt.address||'');
      const dest=encodeURIComponent(nextEvt.address||'');
      nextHTML=`<h3>Next Event: ${nextEvt.title}</h3>
      <a target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${dest}&travelmode=driving">ðŸš— Drive</a>
      <a target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${dest}&travelmode=walking">ðŸš¶ Walk</a>
      <a target="_blank" href="https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${dest}&travelmode=transit">ðŸš‡ Transit</a>`;
    }
    document.getElementById('travelNext').innerHTML=nextHTML;
    document.getElementById('eventModal').style.display='block';
    document.body.style.overflow='hidden';
  }

  function openEventModal(eventObj){
    openEventModalFromId(eventObj.id);
  }

  // Buttons
  document.getElementById('monthViewBtn').onclick=()=>calendar.changeView('dayGridMonth');
  document.getElementById('weekViewBtn').onclick=()=>calendar.changeView('timeGridWeek');
  document.getElementById('dayViewBtn').onclick=()=>calendar.changeView('timeGridDay');

  document.getElementById('toggleViewBtn').onclick=function(){
    isCalendarView=!isCalendarView;
    calendarEl.style.display = isCalendarView ? 'block':'none';
    listEl.style.display = isCalendarView ? 'none':'block';
    if(!isCalendarView) renderList();
  };

  document.getElementById('addEventBtn').onclick=function(){
    currentEventId=null;
    document.getElementById('eventTitle').value='';
    document.getElementById('eventStart').value='';
    document.getElementById('eventEnd').value='';
    document.getElementById('eventAddress').value='';
    document.getElementById('noteReservation').value='';
    document.getElementById('noteCost').value='';
    document.getElementById('noteDirections').value='';
    document.getElementById('noteBring').value='';
    document.getElementById('noteLinks').value='';
    document.getElementById('photoPreview').innerHTML='';
    document.getElementById('travelNext').innerHTML='';
    document.getElementById('eventModal').style.display='block';
    document.body.style.overflow='hidden';
  };

  document.getElementById('modalClose').onclick=function(){
    document.getElementById('eventModal').style.display='none';
    document.body.style.overflow='auto';
  };

  // Photo upload preview
  document.getElementById('notePhotos').onchange=function(e){
    const files=e.target.files;
    const photoPreview = document.getElementById('photoPreview');
    for(let f of files){
      const reader=new FileReader();
      reader.onload=function(ev){
        const img=document.createElement('img'); img.src=ev.target.result;
        const removeBtn = document.createElement('button');
        removeBtn.textContent='Ã—'; removeBtn.className='remove-photo';
        removeBtn.onclick=()=>{ img.remove(); removeBtn.remove(); };
        photoPreview.appendChild(img);
        photoPreview.appendChild(removeBtn);
      };
      reader.readAsDataURL(f);
    }
  };

  // Save event
  document.getElementById('saveEvent').onclick=function(){
    const startDate = new Date(document.getElementById('eventStart').value);
    const endDateInput = document.getElementById('eventEnd').value;
    const endDate = endDateInput ? new Date(endDateInput) : new Date(startDate.getTime() + 60*60*1000);

    const evt={
      id: currentEventId || generateId(),
      title: document.getElementById('eventTitle').value,
      start: toDateTimeLocalString(startDate),
      end: toDateTimeLocalString(endDate),
      address: document.getElementById('eventAddress').value,
      notes:{
        reservation: document.getElementById('noteReservation').value,
        cost: document.getElementById('noteCost').value,
        directions: document.getElementById('noteDirections').value,
        toBring: document.getElementById('noteBring').value,
        links: document.getElementById('noteLinks').value.split(',').map(s=>s.trim()).filter(s=>s),
        photos: Array.from(document.getElementById('photoPreview').querySelectorAll('img')).map(img=>img.src)
      }
    };

    const idx = stored.findIndex(e=>e.id===evt.id);
    if(idx!==-1){ stored[idx]=evt; } else { stored.push(evt); }

    saveToStorage();
    calendar.removeAllEvents();
    calendar.addEventSource(stored);
    if(!isCalendarView) renderList();
    document.getElementById('eventModal').style.display='none';
    document.body.style.overflow='auto';
  };

  // Delete event
  document.getElementById('deleteEvent').onclick = function() {
    if(currentEventId){
      stored = stored.filter(e=>e.id!==currentEventId);
      saveToStorage();
      calendar.removeAllEvents();
      calendar.addEventSource(stored);
      if(!isCalendarView) renderList();
      document.getElementById('eventModal').style.display='none';
    }
  };

});
</script>

</body>
</html>
